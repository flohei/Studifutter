TODOs

- + (NSArray *)localRestaurants in App Delegate bereinigen (ist jetzt im Data Accessor)

///////////////////////////////////////////////////////

- (void)doDownloadMenusForRestaurants {
    NSArray *restaurants = [self localRestaurants];
    BOOL success = YES;
    
    NSMutableArray *exceptions = [[NSMutableArray alloc] init];
    
    // go ahead and look for every menu
    for (Restaurant *r in restaurants) {
        @try {
            if (![[Connection sharedConnection] readMenuForRestaurant:r]) {
                success = NO;
            }
        }
        @catch (NSException *exception) {
            // log the exception
            [exceptions addObject:exception];
        }
    }
    
    // check if there were any exceptions
    if ([exceptions count] > 0) {
        // notify the user
        UIAlertView *message = [[UIAlertView alloc] initWithTitle:@"Hoppla..." 
                                                          message:@"Da ist etwas schiefgelaufen, sorry. Probier's sp√§ter bitte noch einmal." 
                                                         delegate:nil 
                                                cancelButtonTitle:@"OK" 
                                                otherButtonTitles:nil];
        [message show];
        
        // we could loop through all error messages here and create a more adequate string for the user.
        
        exceptions = nil;
    }
    
    [self performSelectorOnMainThread:@selector(finishedDownloadMenusForRestaurant:) withObject:[NSNumber numberWithBool:success] waitUntilDone:YES];
}

- (void)finishedDownloadMenusForRestaurant:(BOOL)success {
    [self cleanupLocalMenus];
    [NSNotificationCenter.defaultCenter postNotification:[NSNotification notificationWithName:MENUS_UPDATED_NOTIFICATION object:nil]];
}
